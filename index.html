<!DOCTYPE html>
<html>
<head>
    <title>Audio Library</title>
    <link rel="stylesheet" href="css/green-audio-player.min.css">
    <script src="js/green-audio-player.min.js"></script>
    <style>
        .audio-block {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
            padding: 20px;
            max-width: 600px;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .audio-main {
            margin-bottom: 15px;
        }

        .cover-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .player-container {
            width: 100%;
            margin: 10px 0;
        }

        .toggle-button {
            width: 100%;
            padding: 10px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: bold;
        }

        .toggle-button:hover {
            background: #eee;
        }

        .toggle-content {
            display: none;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
            margin-top: 10px;
        }

        .toggle-content.active {
            display: block;
        }

        .details-image {
            max-width: 100%;
            border-radius: 4px;
            margin: 10px 0;
        }

        .details-text {
            line-height: 1.6;
            color: #333;
        }

        .metadata {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
            font-size: 0.9em;
            color: #666;
        }

        .tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .tag {
            background: #e0e0e0;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <div id="content"></div>

    <script>
        function createAudioBlock(audioData, audioPath) {
            return `
                <div class="audio-block">
                    <div class="audio-main">
                        ${audioData.hasCover ? 
                            `<img src="${audioPath}/cover.jpg" alt="${audioData.title}" class="cover-image">` : 
                            ''}
                        
                        <div class="player-container">
                            <div class="green-audio-player">
                                <audio>
                                    <source src="${audioPath}/${audioData.audioFile}" type="audio/mpeg">
                                </audio>
                            </div>
                        </div>
                    </div>

                    <button class="toggle-button" onclick="toggleContent('${audioData.id}')">
                        ${audioData.toggleContent.title}
                        <span class="toggle-icon">▼</span>
                    </button>

                    <div class="toggle-content" id="toggle-${audioData.id}">
                        ${audioData.hasDetailsImage ? 
                            `<img src="${audioPath}/details.jpg" alt="Details" class="details-image">` : 
                            ''}
                        
                        <div class="details-text">
                            ${audioData.toggleContent.text}
                        </div>

                        <div class="metadata">
                            <div>Artist: ${audioData.toggleContent.metadata.artist}</div>
                            <div>Genre: ${audioData.toggleContent.metadata.genre}</div>
                            <div>Year: ${audioData.toggleContent.metadata.year}</div>
                            <div>Duration: ${audioData.toggleContent.metadata.duration}</div>
                            <div class="tags">
                                ${audioData.toggleContent.metadata.tags.map(tag => 
                                    `<span class="tag">${tag}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleContent(id) {
            const content = document.getElementById(`toggle-${id}`);
            const button = content.previousElementSibling;
            const icon = button.querySelector('.toggle-icon');
            
            content.classList.toggle('active');
            icon.textContent = content.classList.contains('active') ? '▲' : '▼';
        }

        async function loadAudioContent() {
            try {
                // Get list of audio folders
                const audioFolders = ['melody_001', 'melody_002']; // Example folders
                const container = document.getElementById('content');
                
                for (const folder of audioFolders) {
                    const response = await fetch(`audio/${folder}/info.json`);
                    const audioData = await response.json();
                    container.innerHTML += createAudioBlock(audioData, `audio/${folder}`);
                }

                // Initialize audio players
                GreenAudioPlayer.init({
                    selector: '.green-audio-player',
                    stopOthersOnPlay: true
                });
            } catch (error) {
                console.error('Error loading audio content:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', loadAudioContent);
    </script>
</body>
</html>